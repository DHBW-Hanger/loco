(function framework7ComponentLoader(e,t){void 0===t&&(t=!0);var o=e.$,r=e.utils,n=e.getDevice,a=(e.getSupport,e.Class),i=(e.Modal,e.ConstructorMethods),l=(e.ModalMethods,r.extend),s=r.deleteProps;const c={bold:["bold","format_bold","bold"],italic:["italic","format_italic","italic"],underline:["underline","format_underlined","underline"],strikeThrough:["strikethrough","strikethrough_s","strikeThrough"],orderedList:["list_number","format_list_numbered","insertOrderedList"],unorderedList:["list_bullet","format_list_bulleted","insertUnorderedList"],link:["link","link","createLink"],image:["photo","image","insertImage"],paragraph:["paragraph",'<i class="icon">Â¶</i>',"formatBlock.P"],h1:['<i class="icon">H<sub>1</sub></i>','<i class="icon">H<sub>1</sub></i>',"formatBlock.H1"],h2:['<i class="icon">H<sub>2</sub></i>','<i class="icon">H<sub>2</sub></i>',"formatBlock.H2"],h3:['<i class="icon">H<sub>3</sub></i>','<i class="icon">H<sub>3</sub></i>',"formatBlock.H3"],alignLeft:["text_alignleft","format_align_left","justifyLeft"],alignCenter:["text_aligncenter","format_align_center","justifyCenter"],alignRight:["text_alignright","format_align_right","justifyRight"],alignJustify:["text_justify","format_align_justify","justifyFull"],subscript:["textformat_subscript",'<i class="icon">A<sub>1</sub></i>',"subscript"],superscript:["textformat_superscript",'<i class="icon">A<sup>1</sup></i>',"superscript"],indent:["increase_indent","format_indent_increase","indent"],outdent:["decrease_indent","format_indent_decrease","outdent"]};class d extends a{constructor(e,t){super(t,[e]);const r=this,a=getDocument(),i=n(),s=l({},e.params.textEditor);r.useModulesParams(s),r.params=l(s,t);const c=r.params.el;if(!c)return r;const d=o(c);if(0===d.length)return r;if(d[0].f7TextEditor)return d[0].f7TextEditor;let p=d.children(".text-editor-content");if(p.length||(d.append('<div class="text-editor-content" contenteditable></div>'),p=d.children(".text-editor-content")),l(r,{app:e,$el:d,el:d[0],$contentEl:p,contentEl:p[0]}),"value"in t&&(r.value=r.params.value),"keyboard-toolbar"===r.params.mode&&(i.cordova||i.capacitor||i.android||(r.params.mode="popover")),"string"==typeof r.params.buttons)try{r.params.buttons=JSON.parse(r.params.buttons)}catch(e){throw new Error('Framework7: TextEditor: wrong "buttons" parameter format')}return d[0].f7TextEditor=r,r.onButtonClick=r.onButtonClick.bind(r),r.onFocus=r.onFocus.bind(r),r.onBlur=r.onBlur.bind(r),r.onInput=r.onInput.bind(r),r.onPaste=r.onPaste.bind(r),r.onSelectionChange=r.onSelectionChange.bind(r),r.closeKeyboardToolbar=r.closeKeyboardToolbar.bind(r),r.attachEvents=function(){"toolbar"===r.params.mode&&r.$el.find(".text-editor-toolbar").on("click","button",r.onButtonClick),"keyboard-toolbar"===r.params.mode&&(r.$keyboardToolbarEl.on("click","button",r.onButtonClick),r.$el.parents(".page").on("page:beforeout",r.closeKeyboardToolbar)),"popover"===r.params.mode&&r.popover&&r.popover.$el.on("click","button",r.onButtonClick),r.$contentEl.on("paste",r.onPaste),r.$contentEl.on("focus",r.onFocus),r.$contentEl.on("blur",r.onBlur),r.$contentEl.on("input",r.onInput,!0),o(a).on("selectionchange",r.onSelectionChange)},r.detachEvents=function(){"toolbar"===r.params.mode&&r.$el.find(".text-editor-toolbar").off("click","button",r.onButtonClick),"keyboard-toolbar"===r.params.mode&&(r.$keyboardToolbarEl.off("click","button",r.onButtonClick),r.$el.parents(".page").off("page:beforeout",r.closeKeyboardToolbar)),"popover"===r.params.mode&&r.popover&&r.popover.$el.off("click","button",r.onButtonClick),r.$contentEl.off("paste",r.onPaste),r.$contentEl.off("focus",r.onFocus),r.$contentEl.off("blur",r.onBlur),r.$contentEl.off("input",r.onInput,!0),o(a).off("selectionchange",r.onSelectionChange)},r.useModules(),r.init(),r}setValue(e){const t=this;return t.value===e||(t.value=e,t.$contentEl.html(e),t.$el.trigger("texteditor:change",t.value),t.emit("local::change textEditorChange",t,t.value)),t}getValue(){return this.value}clearValue(){const e=this;return e.setValue(""),e.params.placeholder&&!e.$contentEl.html()&&e.insertPlaceholder(),e}createLink(){const e=this,t=getWindow(),r=getDocument(),n=t.getSelection(),a=[];let i;if(n&&n.anchorNode&&o(n.anchorNode).parents(e.$el).length){let e=n.anchorNode;for(;e;)a.push(e),e.nextSibling&&e!==n.focusNode||(e=null),e&&(e=e.nextSibling);const t=[],r=o(a);for(let e=0;e<r.length;e+=1){const n=r[e].children;if(n)for(let e=0;e<n.length;e+=1)o(n[e]).is("a")&&t.push(n[e])}i=r.closest("a").add(o(t))}if(i&&i.length)return i.each((e=>{const o=t.getSelection(),n=r.createRange();n.selectNodeContents(e),o.removeAllRanges(),o.addRange(n),r.execCommand("unlink",!1),o.removeAllRanges()})),e;const l=e.getSelectionRange();if(!l)return e;return e.app.dialog.prompt(e.params.linkUrlText,"",(t=>{t&&t.trim().length&&(e.setSelectionRange(l),r.execCommand("createLink",!1,t.trim()),e.$el.trigger("texteditor:insertlink",{url:t.trim()}),e.emit("local:insertLink textEditorInsertLink",e,t.trim()))})).$el.find("input").focus(),e}insertImage(){const e=this,t=getDocument(),o=e.getSelectionRange();if(!o)return e;return e.app.dialog.prompt(e.params.imageUrlText,"",(r=>{r&&r.trim().length&&(e.setSelectionRange(o),t.execCommand("insertImage",!1,r.trim()),e.$el.trigger("texteditor:insertimage",{url:r.trim()}),e.emit("local:insertImage textEditorInsertImage",e,r.trim()))})).$el.find("input").focus(),e}removePlaceholder(){this.$contentEl.find(".text-editor-placeholder").remove()}insertPlaceholder(){this.$contentEl.append(`<div class="text-editor-placeholder">${this.params.placeholder}</div>`)}onSelectionChange(){const e=this,t=getWindow(),r=getDocument();if("toolbar"===e.params.mode)return;const n=t.getSelection(),a=o(n.anchorNode).parents(e.contentEl).length||n.anchorNode===e.contentEl;if("keyboard-toolbar"!==e.params.mode){if("popover"===e.params.mode){const i=o(n.anchorNode).parents(e.popover.el).length||n.anchorNode===e.popover.el;if(!a&&!i)return void e.closePopover();if(!n.isCollapsed&&n.rangeCount){const o=n.getRangeAt(0).getBoundingClientRect(),a=e.app.$el[0]||r.body;e.openPopover(o.x+(t.scrollX||0)-a.offsetLeft,o.y+(t.scrollY||0)-a.offsetTop,o.width,o.height)}else n.isCollapsed&&e.closePopover()}}else a?e.openKeyboardToolbar():e.closeKeyboardToolbar()}onPaste(e){const t=getDocument();if(this.params.clearFormattingOnPaste&&e.clipboardData&&e.clipboardData.getData){const o=e.clipboardData.getData("text/plain");e.preventDefault(),t.execCommand("insertText",!1,o)}}onInput(){const e=this,t=e.$contentEl.html();e.value=t,e.$el.trigger("texteditor:input"),e.emit("local:input textEditorInput",e,e.value),e.$el.trigger("texteditor:change",e.value),e.emit("local::change textEditorChange",e,e.value)}onFocus(){const e=this;e.removePlaceholder(),e.$contentEl.focus(),e.$el.trigger("texteditor:focus"),e.emit("local::focus textEditorFocus",e)}onBlur(){const e=this,t=getWindow(),r=getDocument();if(e.params.placeholder&&""===e.$contentEl.html()&&e.insertPlaceholder(),"popover"===e.params.mode){const n=t.getSelection(),a=o(n.anchorNode).parents(e.contentEl).length||n.anchorNode===e.contentEl;r.activeElement&&e.popover&&o(r.activeElement).closest(e.popover.$el).length||a||e.closePopover()}if("keyboard-toolbar"===e.params.mode){const r=t.getSelection();o(r.anchorNode).parents(e.contentEl).length||r.anchorNode===e.contentEl||e.closeKeyboardToolbar()}e.$el.trigger("texteditor:blur"),e.emit("local::blur textEditorBlur",e)}onButtonClick(e){const t=this,r=getWindow(),n=getDocument(),a=r.getSelection();if(!(o(a.anchorNode).parents(t.contentEl).length||a.anchorNode===t.contentEl))return;const i=o(e.target).closest("button");i.parents("form").length&&e.preventDefault();const l=i.attr("data-button"),s=t.params.customButtons&&t.params.customButtons[l];if(!l||!c[l]&&!s)return;if(i.trigger("texteditor:buttonclick",l),t.emit("local::buttonClick textEditorButtonClick",t,l),s)return void(s.onClick&&s.onClick(t,i[0]));const d=c[l][2];if("createLink"!==d)if("insertImage"!==d)if(0!==d.indexOf("formatBlock"))n.execCommand(d,!1);else{const e=d.split(".")[1],t=o(a.anchorNode);t.parents(e.toLowerCase()).length||t.is(e)?n.execCommand("formatBlock",!1,"div"):n.execCommand("formatBlock",!1,e)}else t.insertImage();else t.createLink()}getSelectionRange(){const e=getWindow(),t=getDocument();if(e.getSelection){const t=e.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}else if(t.selection&&t.selection.createRange)return t.selection.createRange();return null}setSelectionRange(e){const t=getWindow(),o=getDocument();if(e)if(t.getSelection){const o=t.getSelection();o.removeAllRanges(),o.addRange(e)}else o.selection&&e.select&&e.select()}renderButtons(){const e=this;let t="";function o(t){const o="md"===e.app.theme?"material-icons":"f7-icons";if(e.params.customButtons&&e.params.customButtons[t]){return`<button type="button" class="text-editor-button" data-button="${t}">${e.params.customButtons[t].content||""}</button>`}if(!c[t])return"";const r=c[t]["md"===e.app.theme?1:0];return`<button type="button" class="text-editor-button" data-button="${t}">${r.indexOf("<")>=0?r:`<i class="${o}">${r}</i>`}</button>`.trim()}return e.params.buttons.forEach(((r,n)=>{Array.isArray(r)?(r.forEach((e=>{t+=o(e)})),n<e.params.buttons.length-1&&e.params.dividers&&(t+='<div class="text-editor-button-divider"></div>')):t+=o(r)})),t}createToolbar(){this.$el.prepend(`<div class="text-editor-toolbar">${this.renderButtons()}</div>`)}createKeyboardToolbar(){this.$keyboardToolbarEl=o(`<div class="toolbar toolbar-bottom text-editor-keyboard-toolbar"><div class="toolbar-inner">${this.renderButtons()}</div></div>`)}createPopover(){const e=this;e.popover=e.app.popover.create({content:`\n          <div class="popover dark text-editor-popover">\n            <div class="popover-inner">${e.renderButtons()}</div>\n          </div>\n        `,closeByOutsideClick:!1,backdrop:!1})}openKeyboardToolbar(){const e=this;e.$keyboardToolbarEl.parent(e.app.$el).length||(e.$el.trigger("texteditor:keyboardopen"),e.emit("local::keyboardOpen textEditorKeyboardOpen",e),e.app.$el.append(e.$keyboardToolbarEl))}closeKeyboardToolbar(){const e=this;e.$keyboardToolbarEl.remove(),e.$el.trigger("texteditor:keyboardclose"),e.emit("local::keyboardClose textEditorKeyboardClose",e)}openPopover(e,t,o,r){const n=this;n.popover&&(Object.assign(n.popover.params,{targetX:e,targetY:t,targetWidth:o,targetHeight:r}),clearTimeout(n.popoverTimeout),n.popoverTimeout=setTimeout((()=>{n.popover&&(n.popover.opened?n.popover.resize():(n.$el.trigger("texteditor:popoveropen"),n.emit("local::popoverOpen textEditorPopoverOpen",n),n.popover.open()))}),400))}closePopover(){const e=this;clearTimeout(e.popoverTimeout),e.popover&&e.popover.opened&&(e.popoverTimeout=setTimeout((()=>{e.popover&&(e.$el.trigger("texteditor:popoverclose"),e.emit("local::popoverClose textEditorPopoverClose",e),e.popover.close())}),400))}init(){const e=this;return e.value?e.$contentEl.html(e.value):e.value=e.$contentEl.html(),e.params.placeholder&&""===e.value&&e.insertPlaceholder(),"toolbar"===e.params.mode?e.createToolbar():"popover"===e.params.mode?e.createPopover():"keyboard-toolbar"===e.params.mode&&e.createKeyboardToolbar(),e.attachEvents(),e.$el.trigger("texteditor:init"),e.emit("local::init textEditorInit",e),e}destroy(){let e=this;e.$el.trigger("texteditor:beforedestroy"),e.emit("local::beforeDestroy textEditorBeforeDestroy",e),e.detachEvents(),"keyboard-toolbar"===e.params.mode&&e.$keyboardToolbarEl&&e.$keyboardToolbarEl.remove(),e.popover&&(e.popover.close(!1),e.popover.destroy()),delete e.$el[0].f7TextEditor,s(e),e=null}}var p={name:"textEditor",params:{textEditor:{el:null,mode:"toolbar",value:void 0,customButtons:null,buttons:[["bold","italic","underline","strikeThrough"],["orderedList","unorderedList"],["link","image"],["paragraph","h1","h2","h3"],["alignLeft","alignCenter","alignRight","alignJustify"],["subscript","superscript"],["indent","outdent"]],dividers:!0,imageUrlText:"Insert image URL",linkUrlText:"Insert link URL",placeholder:null,clearFormattingOnPaste:!0}},create(){this.textEditor=l(i({defaultSelector:".text-editor",constructor:d,app:this,domProp:"f7TextEditor"}))},static:{TextEditor:d},on:{tabMounted(e){const t=this;o(e).find(".text-editor-init").each((e=>{const r=o(e).dataset();t.textEditor.create(l({el:e},r||{}))}))},tabBeforeRemove(e){o(e).find(".text-editor-init").each((e=>{e.f7TextEditor&&e.f7TextEditor.destroy()}))},pageInit(e){const t=this;e.$el.find(".text-editor-init").each((e=>{const r=o(e).dataset();t.textEditor.create(l({el:e},r||{}))}))},pageBeforeRemove(e){e.$el.find(".text-editor-init").each((e=>{e.f7TextEditor&&e.f7TextEditor.destroy()}))}},vnode:{"text-editor-init":{insert(e){const t=e.elm,r=o(t).dataset();this.textEditor.create(l({el:t},r||{}))},destroy(e){const t=e.elm;t.f7TextEditor&&t.f7TextEditor.destroy()}}}};if(t){if(e.prototype.modules&&e.prototype.modules[p.name])return;e.use(p),e.instance&&(e.instance.useModuleParams(p,e.instance.params),e.instance.useModule(p))}return p}(Framework7, typeof Framework7AutoInstallComponent === 'undefined' ? undefined : Framework7AutoInstallComponent))
